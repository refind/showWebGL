THREE.TrackballControls=function(M,D){function u(a){!1!==b.enabled&&(window.removeEventListener("keydown",u),x=d,d===c.NONE)&&(a.keyCode!==b.keys[c.ROTATE]||b.noRotate?a.keyCode!==b.keys[c.ZOOM]||b.noZoom?a.keyCode!==b.keys[c.PAN]||b.noPan||(d=c.PAN):d=c.ZOOM:d=c.ROTATE)}function E(a){!1!==b.enabled&&(d=x,window.addEventListener("keydown",u,!1))}function F(a){!1!==b.enabled&&(a.preventDefault(),a.stopPropagation(),d===c.NONE&&(d=a.button),d!==c.ROTATE||b.noRotate?d!==c.ZOOM||b.noZoom?d!==c.PAN||b.noPan||(l.copy(k(a.pageX,a.pageY)),h.copy(l)):(f.copy(k(a.pageX,a.pageY)),p.copy(f)):(g.copy(q(a.pageX,a.pageY)),m.copy(g)),document.addEventListener("mousemove",y,!1),document.addEventListener("mouseup",z,!1),b.dispatchEvent(A))}function y(a){!1!==b.enabled&&(a.preventDefault(),a.stopPropagation(),d!==c.ROTATE||b.noRotate?d!==c.ZOOM||b.noZoom?d!==c.PAN||b.noPan||h.copy(k(a.pageX,a.pageY)):p.copy(k(a.pageX,a.pageY)):(m.copy(g),g.copy(q(a.pageX,a.pageY))))}function z(a){!1!==b.enabled&&(a.preventDefault(),a.stopPropagation(),d=c.NONE,document.removeEventListener("mousemove",y),document.removeEventListener("mouseup",z),b.dispatchEvent(B))}function v(a){if(!1!==b.enabled){a.preventDefault();a.stopPropagation();var n=0;a.wheelDelta?n=a.wheelDelta/40:a.detail&&(n=-a.detail/3);f.y+=.01*n;b.dispatchEvent(A);b.dispatchEvent(B)}}function G(a){if(!1!==b.enabled){switch(a.touches.length){case 1:d=c.TOUCH_ROTATE;g.copy(q(a.touches[0].pageX,a.touches[0].pageY));m.copy(g);break;case 2:d=c.TOUCH_ZOOM_PAN;var n=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;r=w=Math.sqrt(n*n+e*e);l.copy(k((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));h.copy(l);break;default:d=c.NONE}b.dispatchEvent(A)}}function H(a){if(!1!==b.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:m.copy(g);g.copy(q(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var n=a.touches[0].pageX-a.touches[1].pageX,e=a.touches[0].pageY-a.touches[1].pageY;r=Math.sqrt(n*n+e*e);h.copy(k((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2));break;default:d=c.NONE}}function I(a){if(!1!==b.enabled){switch(a.touches.length){case 1:m.copy(g);g.copy(q(a.touches[0].pageX,a.touches[0].pageY));break;case 2:w=r=0,h.copy(k((a.touches[0].pageX+a.touches[1].pageX)/2,(a.touches[0].pageY+a.touches[1].pageY)/2)),l.copy(h)}d=c.NONE;b.dispatchEvent(B)}}function J(a){a.preventDefault()}var b=this,c={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=M;this.domElement=void 0!==D?D:document;this.enabled=!0;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noPan=this.noZoom=this.noRotate=!1;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var C=new THREE.Vector3,d=c.NONE,x=c.NONE,e=new THREE.Vector3,m=new THREE.Vector2,g=new THREE.Vector2,K=new THREE.Vector3,t=0,f=new THREE.Vector2,p=new THREE.Vector2,w=0,r=0,l=new THREE.Vector2,h=new THREE.Vector2;this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var L={type:"change"},A={type:"start"},B={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var a=this.domElement.getBoundingClientRect(),b=this.domElement.ownerDocument.documentElement;this.screen.left=a.left+window.pageXOffset-b.clientLeft;this.screen.top=a.top+window.pageYOffset-b.clientTop;this.screen.width=a.width;this.screen.height=a.height}};this.handleEvent=function(a){if("function"==typeof this[a.type])this[a.type](a)};var k=function(){var a=new THREE.Vector2;return function(c,e){a.set((c-b.screen.left)/b.screen.width,(e-b.screen.top)/b.screen.height);return a}}(),q=function(){var a=new THREE.Vector2;return function(c,e){a.set((c-.5*b.screen.width-b.screen.left)/(.5*b.screen.width),(b.screen.height+2*(b.screen.top-e))/b.screen.width);return a}}();this.rotateCamera=function(){var a=new THREE.Vector3,c=new THREE.Quaternion,d=new THREE.Vector3,f=new THREE.Vector3,l=new THREE.Vector3,h=new THREE.Vector3,k;return function(){h.set(g.x-m.x,g.y-m.y,0);(k=h.length())?(e.copy(b.object.position).sub(b.target),d.copy(e).normalize(),f.copy(b.object.up).normalize(),l.crossVectors(f,d).normalize(),f.setLength(g.y-m.y),l.setLength(g.x-m.x),h.copy(f.add(l)),a.crossVectors(h,e).normalize(),k*=b.rotateSpeed,c.setFromAxisAngle(a,k),e.applyQuaternion(c),b.object.up.applyQuaternion(c),K.copy(a),t=k):!b.staticMoving&&t&&(t*=Math.sqrt(1-b.dynamicDampingFactor),e.copy(b.object.position).sub(b.target),c.setFromAxisAngle(K,t),e.applyQuaternion(c),b.object.up.applyQuaternion(c));m.copy(g)}}();this.zoomCamera=function(){var a;d===c.TOUCH_ZOOM_PAN?(a=w/r,w=r,e.multiplyScalar(a)):(a=1+(p.y-f.y)*b.zoomSpeed,1!==a&&0<a&&(e.multiplyScalar(a),b.staticMoving?f.copy(p):f.y+=(p.y-f.y)*this.dynamicDampingFactor))};this.panCamera=function(){var a=new THREE.Vector2,c=new THREE.Vector3,d=new THREE.Vector3;return function(){a.copy(h).sub(l);a.lengthSq()&&(a.multiplyScalar(e.length()*b.panSpeed),d.copy(e).cross(b.object.up).setLength(a.x),d.add(c.copy(b.object.up).setLength(a.y)),b.object.position.add(d),b.target.add(d),b.staticMoving?l.copy(h):l.add(a.subVectors(h,l).multiplyScalar(b.dynamicDampingFactor)))}}();this.checkDistances=function(){b.noZoom&&b.noPan||(e.lengthSq()>b.maxDistance*b.maxDistance&&(b.object.position.addVectors(b.target,e.setLength(b.maxDistance)),f.copy(p)),e.lengthSq()<b.minDistance*b.minDistance&&(b.object.position.addVectors(b.target,e.setLength(b.minDistance)),f.copy(p)))};this.update=function(){e.subVectors(b.object.position,b.target);b.noRotate||b.rotateCamera();b.noZoom||b.zoomCamera();b.noPan||b.panCamera();b.object.position.addVectors(b.target,e);b.checkDistances();b.object.lookAt(b.target);1E-6<C.distanceToSquared(b.object.position)&&(b.dispatchEvent(L),C.copy(b.object.position))};this.reset=function(){x=d=c.NONE;b.target.copy(b.target0);b.object.position.copy(b.position0);b.object.up.copy(b.up0);e.subVectors(b.object.position,b.target);b.object.lookAt(b.target);b.dispatchEvent(L);C.copy(b.object.position)};this.dispose=function(){this.domElement.removeEventListener("contextmenu",J,!1);this.domElement.removeEventListener("mousedown",F,!1);this.domElement.removeEventListener("mousewheel",v,!1);this.domElement.removeEventListener("MozMousePixelScroll",v,!1);this.domElement.removeEventListener("touchstart",G,!1);this.domElement.removeEventListener("touchend",I,!1);this.domElement.removeEventListener("touchmove",H,!1);document.removeEventListener("mousemove",y,!1);document.removeEventListener("mouseup",z,!1);window.removeEventListener("keydown",u,!1);window.removeEventListener("keyup",E,!1)};this.domElement.addEventListener("contextmenu",J,!1);this.domElement.addEventListener("mousedown",F,!1);this.domElement.addEventListener("mousewheel",v,!1);this.domElement.addEventListener("MozMousePixelScroll",v,!1);this.domElement.addEventListener("touchstart",G,!1);this.domElement.addEventListener("touchend",I,!1);this.domElement.addEventListener("touchmove",H,!1);window.addEventListener("keydown",u,!1);window.addEventListener("keyup",E,!1);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;