(function(d){var r,t,e;d.extend({roundaboutShapes:{def:"lazySusan",lazySusan:function(a,b,d){return{x:Math.sin(a+b),y:Math.sin(a+3*Math.PI/2+b)/8*d,z:(Math.cos(a+b)+1)/2,scale:Math.sin(a+Math.PI/2+b)/2+.5}}}});r={bearing:0,tilt:0,minZ:100,maxZ:280,minOpacity:.4,maxOpacity:1,minScale:.4,maxScale:1,duration:600,btnNext:null,btnNextCallback:function(){},btnPrev:null,btnPrevCallback:function(){},btnToggleAutoplay:null,btnStartAutoplay:null,btnStopAutoplay:null,easing:"swing",clickToFocus:!0,clickToFocusCallback:function(){},focusBearing:0,shape:"lazySusan",debug:!1,childSelector:"div",startingChild:null,reflect:!1,floatComparisonThreshold:.001,autoplay:!1,autoplayDuration:1E3,autoplayPauseOnHover:!1,autoplayCallback:function(){},enableDrag:!1,dropDuration:600,dropEasing:"swing",dropAnimateTo:"nearest",dropCallback:function(){},dragAxis:"x",dragFactor:4,triggerFocusEvents:!0,triggerBlurEvents:!0,responsive:!1};t={autoplayInterval:null,autoplayIsRunning:!1,animating:!1,childInFocus:-1,touchMoveStartPosition:null,stopAnimation:!1,lastAnimationStep:!1};e={init:function(a,b,f){var c;(new Date).getTime();a="object"===typeof a?a:{};b=d.isFunction(b)?b:function(){};b=d.isFunction(a)?a:b;c=d.extend({},r,a,t);return this.each(function(){var a=d(this),l=a.children(c.childSelector).length,h=360/l,l=c.startingChild&&c.startingChild>l-1?l-1:c.startingChild,m=null===c.startingChild?c.bearing:360-l*h,n="static"!==a.css("position")?a.css("position"):"relative";a.css({padding:0,position:n}).data("roundabout",d.extend({},c,{startingChild:l,bearing:m,oppositeOfFocusBearing:e.normalize.apply(null,[c.focusBearing-180]),dragBearing:m,period:h}));f||(c.clickToFocus&&a.children(c.childSelector).each(function(b){d(this).bind("click.roundabout",function(){var c=e.getPlacement.apply(a,[b]);if(!e.isInFocus.apply(a,[c]))return e.stopAnimation.apply(d(this)),a.data("roundabout").animating||e.animateBearingToFocus.apply(a,[c,a.data("roundabout").clickToFocusCallback]),!1})}),c.btnNext&&d(c.btnNext).bind("click.roundabout",function(){a.data("roundabout").animating||e.animateToNextChild.apply(a,[a.data("roundabout").btnNextCallback]);return!1}),c.btnPrev&&d(c.btnPrev).bind("click.roundabout",function(){e.animateToPreviousChild.apply(a,[a.data("roundabout").btnPrevCallback]);return!1}),c.btnToggleAutoplay&&d(c.btnToggleAutoplay).bind("click.roundabout",function(){e.toggleAutoplay.apply(a);return!1}),c.btnStartAutoplay&&d(c.btnStartAutoplay).bind("click.roundabout",function(){e.startAutoplay.apply(a);return!1}),c.btnStopAutoplay&&d(c.btnStopAutoplay).bind("click.roundabout",function(){e.stopAutoplay.apply(a);return!1}),c.autoplayPauseOnHover&&a.bind("mouseenter.roundabout.autoplay",function(){e.stopAutoplay.apply(a,[!0])}).bind("mouseleave.roundabout.autoplay",function(){e.startAutoplay.apply(a)}),c.enableDrag&&(d.isFunction(a.drag)?d.isFunction(a.drop)?a.drag(function(b,d){var c=a.data("roundabout"),f="x"===c.dragAxis.toLowerCase()?"deltaX":"deltaY";e.stopAnimation.apply(a);e.setBearing.apply(a,[c.dragBearing+d[f]/c.dragFactor])}).drop(function(b){b=a.data("roundabout");var c=e.getAnimateToMethod(b.dropAnimateTo);e.allowAnimation.apply(a);e[c].apply(a,[b.dropDuration,b.dropEasing,b.dropCallback]);b.dragBearing=b.period*e.getNearestChild.apply(a)}):c.debug&&alert("You do not have the drop plugin loaded."):c.debug&&alert("You do not have the drag plugin loaded."),a.each(function(){var a=d(this).get(0),b=d(this).data("roundabout"),c="x"===b.dragAxis.toLowerCase()?"pageX":"pageY",f=e.getAnimateToMethod(b.dropAnimateTo);a.addEventListener&&(a.addEventListener("touchstart",function(a){b.touchMoveStartPosition=a.touches[0][c]},!1),a.addEventListener("touchmove",function(a){var f=(a.touches[0][c]-b.touchMoveStartPosition)/b.dragFactor;a.preventDefault();e.stopAnimation.apply(d(this));e.setBearing.apply(d(this),[b.dragBearing+f])},!1),a.addEventListener("touchend",function(a){a.preventDefault();e.allowAnimation.apply(d(this));f=e.getAnimateToMethod(b.dropAnimateTo);e[f].apply(d(this),[b.dropDuration,b.dropEasing,b.dropCallback]);b.dragBearing=b.period*e.getNearestChild.apply(d(this))},!1))})),c.responsive&&d(window).resize(function(){e.relayoutChildren.apply(a)}));e.initChildren.apply(a,[b,f])})},initChildren:function(a,b){var f=d(this),c=f.data("roundabout");a=a||function(){};f.children(c.childSelector).each(function(a){var c,h,m,n=e.getPlacement.apply(f,[a]);b&&(c=d(this).data("roundabout").startWidth,h=d(this).data("roundabout").startHeight,m=d(this).data("roundabout").startFontSize);d(this).css("position","absolute");d(this).data("roundabout",{startWidth:c||d(this).width(),startHeight:h||d(this).height(),startFontSize:m||parseInt(d(this).css("font-size"),10),degrees:n,backDegrees:e.normalize.apply(null,[n-180]),childNumber:a,currentScale:1,parent:f})});e.updateChildren.apply(f);c.autoplay&&e.startAutoplay.apply(f);f.trigger("ready");a.apply(f);return f},updateChildren:function(){return this.each(function(){var a=d(this),b=a.data("roundabout"),f=-1,c={bearing:b.bearing,tilt:b.tilt,stage:{width:Math.floor(.9*d(this).width()),height:Math.floor(.9*d(this).height())},animating:b.animating,inFocus:b.childInFocus,focusBearingRadian:e.degToRad.apply(null,[b.focusBearing]),shape:d.roundaboutShapes[b.shape]||d.roundaboutShapes[d.roundaboutShapes.def]};c.midStage={width:c.stage.width/2,height:c.stage.height/2};c.nudge={width:c.midStage.width+.05*c.stage.width,height:c.midStage.height+.05*c.stage.height};c.zValues={min:b.minZ,max:b.maxZ,diff:b.maxZ-b.minZ};c.opacity={min:b.minOpacity,max:b.maxOpacity,diff:b.maxOpacity-b.minOpacity};c.scale={min:b.minScale,max:b.maxScale,diff:b.maxScale-b.minScale};a.children(b.childSelector).each(function(g){!e.updateChild.apply(a,[d(this),c,g,function(){d(this).trigger("ready")}])||c.animating&&!b.lastAnimationStep||(f=g)});f!==c.inFocus&&(b.triggerBlurEvents&&a.children(b.childSelector).eq(c.inFocus).trigger("blur"),b.childInFocus=f,b.triggerFocusEvents&&-1!==f&&a.children(b.childSelector).eq(f).trigger("focus"));a.trigger("childrenUpdated")})},updateChild:function(a,b,f,c){var g;a=d(a);var l=a.data("roundabout"),h=[];g=e.degToRad.apply(null,[360-l.degrees+b.bearing]);a.get(0);c=c||function(){};g=e.normalizeRad.apply(null,[g]);g=b.shape(g,b.focusBearingRadian,b.tilt);g.scale=1<g.scale?1:g.scale;g.adjustedScale=(b.scale.min+b.scale.diff*g.scale).toFixed(4);g.width=(g.adjustedScale*l.startWidth).toFixed(4);g.height=(g.adjustedScale*l.startHeight).toFixed(4);a.css({left:(g.x*b.midStage.width+b.nudge.width-g.width/2).toFixed(0)+"px",top:(g.y*b.midStage.height+b.nudge.height-g.height/2).toFixed(0)+"px",width:g.width+"px",height:g.height+"px",opacity:(b.opacity.min+b.opacity.diff*g.scale).toFixed(2),zIndex:Math.round(b.zValues.min+b.zValues.diff*g.z),fontSize:(g.adjustedScale*l.startFontSize).toFixed(1)+"px"});l.currentScale=g.adjustedScale;this.data("roundabout").debug&&(h.push('\x3cdiv style\x3d"font-weight: normal; font-size: 10px; padding: 2px; width: '+a.css("width")+'; background-color: #ffc;"\x3e'),h.push('\x3cstrong style\x3d"font-size: 12px; white-space: nowrap;"\x3eChild '+f+"\x3c/strong\x3e\x3cbr /\x3e"),h.push("\x3cstrong\x3eleft:\x3c/strong\x3e "+a.css("left")+"\x3cbr /\x3e"),h.push("\x3cstrong\x3etop:\x3c/strong\x3e "+a.css("top")+"\x3cbr /\x3e"),h.push("\x3cstrong\x3ewidth:\x3c/strong\x3e "+a.css("width")+"\x3cbr /\x3e"),h.push("\x3cstrong\x3eopacity:\x3c/strong\x3e "+a.css("opacity")+"\x3cbr /\x3e"),h.push("\x3cstrong\x3eheight:\x3c/strong\x3e "+a.css("height")+"\x3cbr /\x3e"),h.push("\x3cstrong\x3ez-index:\x3c/strong\x3e "+a.css("z-index")+"\x3cbr /\x3e"),h.push("\x3cstrong\x3efont-size:\x3c/strong\x3e "+a.css("font-size")+"\x3cbr /\x3e"),h.push("\x3cstrong\x3escale:\x3c/strong\x3e "+a.data("roundabout").currentScale),h.push("\x3c/div\x3e"),a.html(h.join("")));a.trigger("reposition");c.apply(this);return e.isInFocus.apply(this,[l.degrees])},setBearing:function(a,b){b=b||function(){};a=e.normalize.apply(null,[a]);this.each(function(){var b,c=d(this),g=c.data("roundabout"),l=g.bearing;g.bearing=a;c.trigger("bearingSet");e.updateChildren.apply(c);b=Math.abs(l-a);!g.animating||180<b||(b=Math.abs(l-a),c.children(g.childSelector).each(function(b){e.isChildBackDegreesBetween.apply(d(this),[a,l])&&(b=l>a?"Clockwise":"Counterclockwise",d(this).trigger("move"+b+"ThroughBack"))}))});b.apply(this);return this},adjustBearing:function(a,b){b=b||function(){};if(0===a)return this;this.each(function(){e.setBearing.apply(d(this),[d(this).data("roundabout").bearing+a])});b.apply(this);return this},setTilt:function(a,b){b=b||function(){};this.each(function(){d(this).data("roundabout").tilt=a;e.updateChildren.apply(d(this))});b.apply(this);return this},adjustTilt:function(a,b){b=b||function(){};this.each(function(){e.setTilt.apply(d(this),[d(this).data("roundabout").tilt+a])});b.apply(this);return this},animateToBearing:function(a,b,f,c,g){var l=(new Date).getTime();g=g||function(){};d.isFunction(c)?(g=c,c=null):d.isFunction(f)?(g=f,f=null):d.isFunction(b)&&(g=b,b=null);this.each(function(){var h,m,n=d(this),k=n.data("roundabout"),p=b?b:k.duration,q=f?f:k.easing||"swing";c||(c={timerStart:l,start:k.bearing,totalTime:p});h=l-c.timerStart;k.stopAnimation?(e.allowAnimation.apply(n),k.animating=!1):h<p?(k.animating||n.trigger("animationStart"),k.animating=!0,"string"===typeof d.easing.def?(m=d.easing[q]||d.easing[d.easing.def],h=m(null,h,c.start,a-c.start,c.totalTime)):(h=d.easing[q](h/c.totalTime),h=c.start+(a-c.start)*h),h=e.normalize.apply(null,[h]),k.dragBearing=h,e.setBearing.apply(n,[h,function(){setTimeout(function(){e.animateToBearing.apply(n,[a,p,q,c,g])},0)}])):(k.animating&&n.trigger("animationEnd"),k.lastAnimationStep=!0,a=e.normalize.apply(null,[a]),e.setBearing.apply(n,[a]),k.animating=!1,k.lastAnimationStep=!1,k.dragBearing=a,g.apply(n))});return this},animateToNearbyChild:function(a,b){var f=a[0],c=a[1],g=a[2]||function(){};d.isFunction(c)?(g=c,c=null):d.isFunction(f)&&(g=f,f=null);return this.each(function(){var a,h,m,n=d(this),k=n.data("roundabout"),p=k.reflect?k.bearing:k.bearing%360,q=n.children(k.childSelector).length;if(!k.animating)if(k.reflect&&"previous"===b||!k.reflect&&"next"===b)for(p=Math.abs(p)<k.floatComparisonThreshold?360:p,m=0;m<q;m+=1){if(a=k.period*m,h=k.period*(m+1),h=m===q-1?360:h,p<=Math.ceil(h)&&p>=Math.floor(a)){2===q&&360===p?e.animateToDelta.apply(n,[-180,f,c,g]):e.animateBearingToFocus.apply(n,[a,f,c,g]);break}}else for(p=Math.abs(p)<k.floatComparisonThreshold||360-Math.abs(p)<k.floatComparisonThreshold?0:p,m=q-1;0<=m;--m)if(a=k.period*m,h=k.period*(m+1),h=m===q-1?360:h,p>=Math.floor(a)&&p<Math.ceil(h)){2===q&&360===p?e.animateToDelta.apply(n,[180,f,c,g]):e.animateBearingToFocus.apply(n,[h,f,c,g]);break}})},animateToNearestChild:function(a,b,f){f=f||function(){};d.isFunction(b)?(f=b,b=null):d.isFunction(a)&&(f=a,a=null);return this.each(function(){var c=e.getNearestChild.apply(d(this));e.animateToChild.apply(d(this),[c,a,b,f])})},animateToChild:function(a,b,f,c){c=c||function(){};d.isFunction(f)?(c=f,f=null):d.isFunction(b)&&(c=b,b=null);return this.each(function(){var g,l=d(this);g=l.data("roundabout");g.childInFocus===a||g.animating||(g=l.children(g.childSelector).eq(a),e.animateBearingToFocus.apply(l,[g.data("roundabout").degrees,b,f,c]))})},animateToNextChild:function(a,b,d){return e.animateToNearbyChild.apply(this,[arguments,"next"])},animateToPreviousChild:function(a,b,d){return e.animateToNearbyChild.apply(this,[arguments,"previous"])},animateToDelta:function(a,b,f,c){c=c||function(){};d.isFunction(f)?(c=f,f=null):d.isFunction(b)&&(c=b,b=null);return this.each(function(){var g=d(this).data("roundabout").bearing+a;e.animateToBearing.apply(d(this),[g,b,f,c])})},animateBearingToFocus:function(a,b,f,c){c=c||function(){};d.isFunction(f)?(c=f,f=null):d.isFunction(b)&&(c=b,b=null);return this.each(function(){var g=d(this).data("roundabout").bearing-a,g=Math.abs(360-g)<Math.abs(g)?360-g:-g,g=180<g?-(360-g):g;0!==g&&e.animateToDelta.apply(d(this),[g,b,f,c])})},stopAnimation:function(){return this.each(function(){d(this).data("roundabout").stopAnimation=!0})},allowAnimation:function(){return this.each(function(){d(this).data("roundabout").stopAnimation=!1})},startAutoplay:function(a){return this.each(function(){var b=d(this),f=b.data("roundabout");a=a||f.autoplayCallback||function(){};clearInterval(f.autoplayInterval);f.autoplayInterval=setInterval(function(){e.animateToNextChild.apply(b,[a])},f.autoplayDuration);f.autoplayIsRunning=!0;b.trigger("autoplayStart")})},stopAutoplay:function(a){return this.each(function(){clearInterval(d(this).data("roundabout").autoplayInterval);d(this).data("roundabout").autoplayInterval=null;d(this).data("roundabout").autoplayIsRunning=!1;a||d(this).unbind(".autoplay");d(this).trigger("autoplayStop")})},toggleAutoplay:function(a){return this.each(function(){var b=d(this).data("roundabout");a=a||b.autoplayCallback||function(){};e.isAutoplaying.apply(d(this))?e.stopAutoplay.apply(d(this),[a]):e.startAutoplay.apply(d(this),[a])})},isAutoplaying:function(){return this.data("roundabout").autoplayIsRunning},changeAutoplayDuration:function(a){return this.each(function(){var b=d(this);b.data("roundabout").autoplayDuration=a;e.isAutoplaying.apply(b)&&(e.stopAutoplay.apply(b),setTimeout(function(){e.startAutoplay.apply(b)},10))})},normalize:function(a){a%=360;return 0>a?360+a:a},normalizeRad:function(a){for(;0>a;)a+=2*Math.PI;for(;a>2*Math.PI;)a-=2*Math.PI;return a},isChildBackDegreesBetween:function(a,b){var f=d(this).data("roundabout").backDegrees;return a>b?f>=b&&f<a:f<b&&f>=a},getAnimateToMethod:function(a){a=a.toLowerCase();return"next"===a?"animateToNextChild":"previous"===a?"animateToPreviousChild":"animateToNearestChild"},relayoutChildren:function(){return this.each(function(){var a=d(this),b=d.extend({},a.data("roundabout"));b.startingChild=a.data("roundabout").childInFocus;e.init.apply(a,[b,null,!0])})},getNearestChild:function(){var a=d(this),b=a.data("roundabout"),a=a.children(b.childSelector).length;return b.reflect?Math.round(b.bearing/b.period)%a:(a-Math.round(b.bearing/b.period)%a)%a},degToRad:function(a){return e.normalize.apply(null,[a])*Math.PI/180},getPlacement:function(a){var b=this.data("roundabout");return b.reflect?b.period*a:360-b.period*a},isInFocus:function(a){var b=this.data("roundabout"),d=e.normalize.apply(null,[b.bearing]);a=e.normalize.apply(null,[a]);a=Math.abs(d-a);return a<=b.floatComparisonThreshold||a>=360-b.floatComparisonThreshold}};d.fn.roundabout=function(a){if(e[a])return e[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof a||d.isFunction(a)||!a)return e.init.apply(this,arguments);d.error("Method "+a+" does not exist for jQuery.roundabout.")}})(jQuery);