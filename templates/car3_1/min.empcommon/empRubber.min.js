(function(){jQuery.fn.extend({empRubber:function(b,d){return new jQuery.empRubber(this,b,d)}});jQuery.empRubber=function(b,d,e){function q(a,c){return{x:c?a.touches[0].pageX/EmpGlobalZoom-EmpGlobalLeft-a.originalEvent.offsetLeft:a.offsetX/EmpGlobalZoom,y:c?a.touches[0].pageY/EmpGlobalZoom-EmpGlobalTop-a.originalEvent.offsetTop:a.offsetY/EmpGlobalZoom}}function t(){var b="ontouchstart"in window?!0:!1,f,d,n;a.ctx.lineCap="round";a.ctx.lineJoin="round";a.ctx.lineWidth=2*g;a.ctx.globalCompositeOperation="destination-out";h.bind("touchstart mousedown",function(e){function g(a){clearTimeout(p);a.preventDefault();f=q(a,b);d=f.x;n=f.y;r(k,l,d,n);k=d;l=n}clearTimeout(p);e.preventDefault();f=q(e,b);k=f.x;l=f.y;r(k,l);h.bind("touchmove mousemove",g);jQuery(document.body).one("touchend mouseup",function(){h.unbind("touchmove mousemove",g);p=setTimeout(function(){if(.01<parseFloat(c.style.opacity)){for(var b=a.ctx.getImageData(0,0,c.width,c.height),d=0,f=0;f<b.width;f+=m)for(var e=0;e<b.height;e+=m)0<b.data[4*(e*b.width+f)+3]&&d++;d/(b.width*b.height/(m*m))<u&&h.animo({animation:"fadeOut",iterate:"1",delay:0,duration:1,keep:!1,timing:"liner"},function(){c.style.opacity="0.0"})}},v)})})}function r(b,c,d,e){a.ctx.save();a.ctx.beginPath();2==arguments.length?(a.ctx.arc(b,c,g,0,2*Math.PI),a.ctx.fill()):(a.ctx.moveTo(b,c),a.ctx.lineTo(d,e),a.ctx.stroke());a.ctx.restore()}b=document.getElementById(d);var c=empGetElementByID(d+"_rubber","canvas",b);this.ctx=c.getContext("2d");var k,l,p,v=parseFloat(e.triggerTime)||100,u=parseFloat(e.triggerArea)||.4,g=parseInt(e.radius)||30,m=g,h=jQuery("#"+d+"_rubber");c.width=parseInt(b.style.width);c.height=parseInt(b.style.height);c.style.opacity="1";var a=this;this.img=new Image;this.img.src=e.maskfile;this.img.onload=function(){a.ctx.drawImage(a.img,0,0,c.width,c.height);t()};this.resetRubber=function(){a.ctx.save();a.ctx.globalCompositeOperation="source-over";a.ctx.drawImage(a.img,0,0,c.width,c.height);c.style.opacity="1.0";a.ctx.globalCompositeOperation="destination-out"};return this}})();